---
title: "CW3"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(GGally)
library(dplyr)
library(ggplot2)
library(car)
library(ggpubr)
library(gridExtra)
library(stringr)
library(tidyverse)

data <- read.csv("AirnbnbRio.csv")
```


```{r}
#Converting character variable to factor variables.
data$host_response_rate <- as.factor(data$host_response_rate)
data$neighbourhood <- as.factor(data$neighbourhood)
data$property_type <- as.factor(data$property_type)
data$room_type <- as.factor(data$room_type)

summary(data)
```


```{r}
#Converting N/A in host response rate into NAs.
data$host_response_rate <- na_if(data$host_response_rate,"N/A")

#Reformatting host_response_rate to a numerical variable and removes % sign.
levels(data$host_response_rate) <- str_replace_all(levels(data$host_response_rate), "%", "")
data$host_response_rate <- as.numeric(data$host_response_rate)
```

```{r}
#Proportion of missingness in data set for each variables
apply(is.na(data),2,mean)
#the proportion of complete cases
mean(apply(is.na(data),1,sum)==0)

source("plot.miss.R")
plot.miss(data, c(2,3,7,12,13))
#Looks random

#correlation between missingness and variables.
resp_miss <-is.na(data$host_response_rate)
cor(data[,-c(2:6)],resp_miss,use= "pairwise")

par(mfrow = c(1,2))
boxplot(data$number_of_reviews~ resp_miss)
#missingness not dep on no. of reviews
boxplot(data$reviews_per_month~ resp_miss)
#missingness dep on revs per month so MAR as median doesn't lie inside the IQR
```

```{r}
#Changing column names
colnames(data)<-c("price","resp_rate","list_count","n_hood","prop_type","room_type", "bathrooms", "accommodates", "guests", "min_nights", "num_reviews", "revs_month", "revs_rating", "avail_30")
```

```{r}
#Correlation matrix
cvars<-c(colnames(data)[-c(4,5,6)])
noNAs <- na.omit(data[,-c(4,5,6)]) 
cors <- round(cor(noNAs, use = "pairwise"),2)
cors
```
Reading from the table tells us which explanatory variables have high correlation and have the potential to be removed from our models later on if a highly correlated variable already exists and which variables to expect to be in final models. 

We do not want multicollinearity affecting our model and resulting in less accurate statistical inferences.
High correlations are as follows:

* Price: bathrooms(0.54), accommodates(0.50), guests(0.28)
* Bathrooms: accommodates(0.58), guests(0.34)
* Accommodates: guests(0.49)
* Number of reviews: reviews per month(0.57)

Response rate, host listing counts, review rating and 30 day availability appear to not be strongly correlated with any of the other factors.


```{r}
par(mfrow = c(3,5))
for(v in cvars[])hist(data[,v], xlab =v, main = c("Histogram of", v))
barplot(xtabs(~data$n_hood),las=1, main = c("Barplot of ","Neighbourhood"))
barplot(xtabs(~data$prop_type),las= 1,main = c("Barplot of ","Property Type"))
barplot(xtabs(~data$room_type),las= 1,main = c("Barplot of ","Room Type"))
```

```{r}
#Removes large min nights values from dataset
sensible_nights <- data$min_nights[data$min_nights<200]
xtabs(~sensible_nights)
hist(sensible_nights)
prop.table(xtabs(~data$bathrooms))
```

# Discussing histograms & distributions of data

* Price: right-skewed
* Response Rate: majority are close to 0 
* Listings count: majority are close to 0
* Neighbourhood: majority in Copacabana
* Property type: most are apartments
* Room type: most are entire home
* Bathrooms: right skewed
* Accomodates:right skewed
* Guests: right-skewed
* Min nights: right-skewed with some large values (300,365,1000)
* Num of reviews: right-skewed many values with only 1 observation, might require some grouping for those
* Revs per month: right-skewed
* Revs rating: left-skewed
* Available 30: somewhat uniform in middle with very large tails

```{r}
#also checking for skew with density plots
par(mfrow = c(3,5))
for(v in cvars[])densityPlot(data[,v], xlab =v, main = c("Density of", v))
```

```{r, echo=FALSE}
#investigating outliers with boxplots
par(mfrow = c(3,4))
for(v in cvars[])boxplot(data[,v], main = v, las = 2)
```


# Question 1

Plotting our variables against price gives us an idea of any problems (outliers, unrealistic values etc.) or features of the data that we didn't detect in our summaries.

```{r, echo=FALSE}
par(mfrow=c(3,4))
for(v in cvars[-1])plot(data[,v], data$price, xlab =v, ylab="Price")
```

```{r}
plot(density(data$price))
ggqqplot(data$price)
ggqqplot(log(data$price))
```

So price qqplot is a crazy shape but log(price) seems to have almost normal distribution. May come in useful!
Price looks almost like a gamma distribution
```{r}
which(cors[,1]>0.25)
```

```{r}
x<-lm(price~ resp_rate +list_count+ bathrooms+ accommodates+ guests+ min_nights+ num_reviews+ revs_month+ revs_rating+ avail_30,data=data)
par(mfrow=c(2,2))
step=step(x) ; summary(step) ; plot(step) ; AIC(step) 
```
We see that only some variables are statistically significant in predicting price, namely: resp_rate, list_count, bathrooms, accommodates, guests, revs_month, revs_rating and avail_30.
